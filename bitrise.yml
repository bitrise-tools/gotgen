format_version: "8"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: ""
app:
  envs:
  - GOFLAGS: -mod=vendor
    opts:
      title: Opt-in vendoring
      description: |
        Since Go 1.12 vendoring is an opt-in feature when working outside of GOPATH.
        You can enable it via the `-mod=vendor` flag or specifying that as a `GOFLAGS` env var.
        More info https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away
      is_expand: false
workflows:
  build:
    steps:
    - script:
        title: Go build
        inputs:
        - content: go build
  deps-update:
    title: Godeps update
    description: |
      Used for updating Go dependencies with godep
    steps:
    - script:
        title: godep update
        inputs:
        - content: |
            #!/bin/bash
            set -ex

            rm -rf ./vendor
            rm go.mod
            rm go.sum

            go mod init
            go mod tidy
            go mod vendor
  test:
    steps:
    - go-list: {}
    - golint: {}
    - errcheck: {}
    - script:
        title: Go test
        inputs:
        - content: go test ./...
